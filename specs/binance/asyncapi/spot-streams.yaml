asyncapi: 3.0.0
info:
  title: Binance Spot WebSocket Streams
  version: 1.0.0
  description: |
    AsyncAPI specification for Binance Spot WebSocket Streams (Market Data).

    This specification covers:
    1. Market Data Streams: Real-time spot market data without authentication

    ## Connection Types

    ### Single Market Streams
    - Connection: Connect to `/ws/{streamName}` directly (or connect to `/ws` and SUBSCRIBE)
    - Data Format: Direct stream data (not wrapped)
    - Property: `combined = false`
    - Example: `wss://stream.binance.com:9443/ws/btcusdt@aggTrade`

    ### Combined Market Streams (Multiple Streams)
    - Connection: Connect to `/stream?streams=<streamName1>/<streamName2>`
    - Data Format: Wrapped as `{"stream":"<streamName>","data":<rawPayload>}`
    - Property: `combined = true`
    - Max Streams: 1024 streams per connection
    - Example: `wss://stream.binance.com:9443/stream?streams=btcusdt@aggTrade/ethusdt@kline_1m`
    - Optional: Add `&timeUnit=MICROSECOND` for microsecond precision

    ## Connection Management

    ### Initial Connection
    - Market Streams: Connect to `/ws/{streamName}` for single streams or `/stream` for combined streams
    - Use SUBSCRIBE method to add streams dynamically

    ### Heartbeat
    - Server sends ping periodically (about every 20s)
    - Client must respond with pong within 1 minute
    - Connection will be disconnected if no pong received

    ### Limits and Validity
    - Connection Validity: up to 24 hours
    - Rate Limit: 5 incoming messages per second
    - Streams per Connection: Maximum 1024 streams (market streams)
    - Connections per IP: Rate limiting applies

    ### Stream Naming Conventions
    - Symbols are lowercase (e.g., btcusdt)
    - Stream names are lowercase
    - Multiple streams can be combined in a single connection

servers:
  mainnet:
    host: stream.binance.com:9443
    protocol: wss
    pathname: /
    title: Binance Spot Server
    summary: Binance Spot WebSocket Streams Server (Mainnet)
    description: WebSocket server for Binance spot market data streams (mainnet)

  mainnetAlt:
    host: stream.binance.com:443
    protocol: wss
    pathname: /
    title: Binance Spot Server (Alternative)
    summary: Binance Spot WebSocket Streams Server (Mainnet Alternative)
    description: Alternative WebSocket server for Binance spot market data streams (mainnet)

  mainnetData:
    host: data-stream.binance.vision
    protocol: wss
    pathname: /
    title: Binance Spot Market Data Server
    summary: Binance Spot WebSocket Streams Server (Market Data Only)
    description: WebSocket server for Binance spot market data streams (market data only)

  testnet:
    host: stream.testnet.binance.vision
    protocol: wss
    pathname: /
    title: Binance Spot Testnet Server
    summary: Binance Spot WebSocket Streams Server (Testnet)
    description: WebSocket server for Binance spot market data streams (testnet)

channels:
  # Single market stream connection (connect to /ws/<streamName> directly)
  marketStream:
    address: /ws/{streamName}
    title: Single Market Streams Connection
    description: |
      Direct connection endpoint for individual market streams. Connect here to receive
      data from a specific stream. Each stream returns direct data. Alternatively, connect
      to `/ws` and use SUBSCRIBE to add streams dynamically.
      
      Optional time unit for timestamps can be specified as an additional query parameter
      on the URL: `&timeUnit=MICROSECOND`.
    parameters:
      streamName:
        description: The specific stream name to connect to
        examples:
          - 'btcusdt@aggTrade'
          - 'btcusdt@kline_1m'
          - 'btcusdt@bookTicker'
          - '!ticker@arr'
    messages:
      subscribe:
        $ref: '#/components/messages/subscribeRequest'
      unsubscribe:
        $ref: '#/components/messages/unsubscribeRequest'
      subscribeResponse:
        $ref: '#/components/messages/subscribeResponse'
      unsubscribeResponse:
        $ref: '#/components/messages/unsubscribeResponse'
      listSubscriptions:
        $ref: '#/components/messages/listSubscriptionsRequest'
      listSubscriptionsResponse:
        $ref: '#/components/messages/listSubscriptionsResponse'
      setProperty:
        $ref: '#/components/messages/setPropertyRequest'
      setPropertyResponse:
        $ref: '#/components/messages/setPropertyResponse'
      getProperty:
        $ref: '#/components/messages/getPropertyRequest'
      getPropertyResponse:
        $ref: '#/components/messages/getPropertyResponse'
      error:
        $ref: '#/components/messages/errorMessage'
      # Single stream data messages (direct, not wrapped)
      aggregateTradeEvent:
        $ref: '#/components/messages/aggregateTradeEvent'
      tradeEvent:
        $ref: '#/components/messages/tradeEvent'
      klineEvent:
        $ref: '#/components/messages/klineEvent'
      miniTickerEvent:
        $ref: '#/components/messages/miniTickerEvent'
      allMiniTickersEvent:
        $ref: '#/components/messages/allMiniTickersEvent'
      tickerEvent:
        $ref: '#/components/messages/tickerEvent'
      allTickersEvent:
        $ref: '#/components/messages/allTickersEvent'
      rollingWindowTickerEvent:
        $ref: '#/components/messages/rollingWindowTickerEvent'
      allRollingWindowTickersEvent:
        $ref: '#/components/messages/allRollingWindowTickersEvent'
      bookTickerEvent:
        $ref: '#/components/messages/bookTickerEvent'
      avgPriceEvent:
        $ref: '#/components/messages/avgPriceEvent'
      partialDepthEvent:
        $ref: '#/components/messages/partialDepthEvent'
      diffDepthEvent:
        $ref: '#/components/messages/diffDepthEvent'

  # Combined stream connection (connect to /stream?streams=...)
  combinedMarketStream:
    address: /stream?streams={streams}
    title: Combined Market Streams Connection
    description: |
      Initial connection endpoint for combined market streams. Connect here first, then use
      query parameters or SUBSCRIBE method to add multiple streams. Each stream returns wrapped data
      with format: {"stream":"<streamName>","data":<rawPayload>}. Optional timestamp precision can be
      specified via `&timeUnit=MICROSECOND`.
    x-unwrapped-event-messages:
      - aggregateTradeEvent
      - tradeEvent
      - klineEvent
      - miniTickerEvent
      - allMiniTickersEvent
      - tickerEvent
      - allTickersEvent
      - rollingWindowTickerEvent
      - allRollingWindowTickersEvent
      - bookTickerEvent
      - avgPriceEvent
      - partialDepthEvent
      - diffDepthEvent
    parameters:
      streams:
        description: |
          Slash-separated list of stream names to subscribe on connect.
          Format: `<streamName1>/<streamName2>/<streamName3>`.
        examples:
          - btcusdt@aggTrade/ethusdt@kline_1m
          - btcusdt@bookTicker/!miniTicker@arr
          - btcusdt@depth5@100ms/ethusdt@ticker_4h
    messages:
      subscribe:
        $ref: '#/components/messages/subscribeRequest'
      unsubscribe:
        $ref: '#/components/messages/unsubscribeRequest'
      subscribeResponse:
        $ref: '#/components/messages/subscribeResponse'
      unsubscribeResponse:
        $ref: '#/components/messages/unsubscribeResponse'
      listSubscriptions:
        $ref: '#/components/messages/listSubscriptionsRequest'
      listSubscriptionsResponse:
        $ref: '#/components/messages/listSubscriptionsResponse'
      setProperty:
        $ref: '#/components/messages/setPropertyRequest'
      setPropertyResponse:
        $ref: '#/components/messages/setPropertyResponse'
      getProperty:
        $ref: '#/components/messages/getPropertyRequest'
      getPropertyResponse:
        $ref: '#/components/messages/getPropertyResponse'
      error:
        $ref: '#/components/messages/errorMessage'
      # Combined market streams data messages (wrapped format)
      combinedMarketStreamEvent:
        $ref: '#/components/messages/combinedMarketStreamEvent'

operations:
  # Single market stream operations
  marketStreamSubscribe:
    title: Subscribe to Single Market Streams
    summary: Subscribe to market streams on single connection
    description: |
      Subscribe to market data streams on single connection. Each stream returns
      direct data without wrapping. Maximum 1024 streams per connection.
    action: send
    x-channel-method: Subscribe
    channel:
      $ref: '#/channels/marketStream'
    messages:
      - $ref: '#/channels/marketStream/messages/subscribe'
    reply:
      channel:
        $ref: '#/channels/marketStream'
      messages:
        - $ref: '#/channels/marketStream/messages/subscribeResponse'

  marketStreamUnsubscribe:
    title: Unsubscribe from Single Market Streams
    summary: Unsubscribe from market streams on single connection
    action: send
    x-channel-method: Unsubscribe
    channel:
      $ref: '#/channels/marketStream'
    messages:
      - $ref: '#/channels/marketStream/messages/unsubscribe'
    reply:
      channel:
        $ref: '#/channels/marketStream'
      messages:
        - $ref: '#/channels/marketStream/messages/unsubscribeResponse'

  marketStreamListSubscriptions:
    title: List Single Stream Subscriptions
    summary: Get list of active single stream subscriptions
    action: send
    x-channel-method: ListSubscriptions
    channel:
      $ref: '#/channels/marketStream'
    messages:
      - $ref: '#/channels/marketStream/messages/listSubscriptions'
    reply:
      channel:
        $ref: '#/channels/marketStream'
      messages:
        - $ref: '#/channels/marketStream/messages/listSubscriptionsResponse'

  marketStreamReceiveEvents:
    title: Receive Single Stream Data
    summary: Receive direct stream data from single connection
    description: |
      Receive market data from subscribed streams. Data is returned directly
      without wrapping.
    action: receive
    channel:
      $ref: '#/channels/marketStream'
    messages:
      - $ref: '#/channels/marketStream/messages/aggregateTradeEvent'
      - $ref: '#/channels/marketStream/messages/tradeEvent'
      - $ref: '#/channels/marketStream/messages/klineEvent'
      - $ref: '#/channels/marketStream/messages/miniTickerEvent'
      - $ref: '#/channels/marketStream/messages/allMiniTickersEvent'
      - $ref: '#/channels/marketStream/messages/tickerEvent'
      - $ref: '#/channels/marketStream/messages/allTickersEvent'
      - $ref: '#/channels/marketStream/messages/rollingWindowTickerEvent'
      - $ref: '#/channels/marketStream/messages/allRollingWindowTickersEvent'
      - $ref: '#/channels/marketStream/messages/bookTickerEvent'
      - $ref: '#/channels/marketStream/messages/avgPriceEvent'
      - $ref: '#/channels/marketStream/messages/partialDepthEvent'
      - $ref: '#/channels/marketStream/messages/diffDepthEvent'

  marketStreamReceiveError:
    title: Receive Error Messages from Single Market Streams
    summary: Receive error messages from single market stream connection
    description: Receive error messages in response to invalid requests or other issues.
    action: receive
    channel:
      $ref: '#/channels/marketStream'
    messages:
      - $ref: '#/channels/marketStream/messages/error'

  # Property control operations for single stream connection
  marketStreamSetProperty:
    title: Set Property on Single Market Streams
    summary: Set a property on the single market stream connection
    action: send
    x-channel-method: SetProperty
    channel:
      $ref: '#/channels/marketStream'
    messages:
      - $ref: '#/channels/marketStream/messages/setProperty'
    reply:
      channel:
        $ref: '#/channels/marketStream'
      messages:
        - $ref: '#/channels/marketStream/messages/setPropertyResponse'

  marketStreamGetProperty:
    title: Get Property from Single Market Streams
    summary: Get a property from the single market stream connection
    action: send
    x-channel-method: GetProperty
    channel:
      $ref: '#/channels/marketStream'
    messages:
      - $ref: '#/channels/marketStream/messages/getProperty'
    reply:
      channel:
        $ref: '#/channels/marketStream'
      messages:
        - $ref: '#/channels/marketStream/messages/getPropertyResponse'

  # Combined market stream operations
  combinedMarketStreamSubscribe:
    title: Subscribe to Combined Market Streams
    summary: Subscribe to market streams on combined connection
    description: |
      Subscribe to market data streams on combined connection. Each stream returns
      wrapped data with stream name identifier. Maximum 1024 streams per connection.
    action: send
    x-channel-method: Subscribe
    channel:
      $ref: '#/channels/combinedMarketStream'
    messages:
      - $ref: '#/channels/combinedMarketStream/messages/subscribe'
    reply:
      channel:
        $ref: '#/channels/combinedMarketStream'
      messages:
        - $ref: '#/channels/combinedMarketStream/messages/subscribeResponse'

  combinedMarketStreamUnsubscribe:
    title: Unsubscribe from Combined Market Streams
    summary: Unsubscribe from market streams on combined connection
    action: send
    x-channel-method: Unsubscribe
    channel:
      $ref: '#/channels/combinedMarketStream'
    messages:
      - $ref: '#/channels/combinedMarketStream/messages/unsubscribe'
    reply:
      channel:
        $ref: '#/channels/combinedMarketStream'
      messages:
        - $ref: '#/channels/combinedMarketStream/messages/unsubscribeResponse'

  combinedMarketStreamListSubscriptions:
    title: List Combined Stream Subscriptions
    summary: Get list of active combined stream subscriptions
    action: send
    x-channel-method: ListSubscriptions
    channel:
      $ref: '#/channels/combinedMarketStream'
    messages:
      - $ref: '#/channels/combinedMarketStream/messages/listSubscriptions'
    reply:
      channel:
        $ref: '#/channels/combinedMarketStream'
      messages:
        - $ref: '#/channels/combinedMarketStream/messages/listSubscriptionsResponse'

  combinedMarketStreamReceiveEvents:
    title: Receive Combined Stream Data
    summary: Receive wrapped stream data from combined connection
    description: |
      Receive market data from subscribed streams. Each message is wrapped with
      stream name and original data: {"stream":"<streamName>","data":<rawPayload>}
    action: receive
    channel:
      $ref: '#/channels/combinedMarketStream'
    messages:
      - $ref: '#/channels/combinedMarketStream/messages/combinedMarketStreamEvent'

  # Property control operations for combined stream connection
  combinedMarketStreamSetProperty:
    title: Set Property on Combined Market Streams
    summary: Set a property on the combined market stream connection
    action: send
    x-channel-method: SetProperty
    channel:
      $ref: '#/channels/combinedMarketStream'
    messages:
      - $ref: '#/channels/combinedMarketStream/messages/setProperty'
    reply:
      channel:
        $ref: '#/channels/combinedMarketStream'
      messages:
        - $ref: '#/channels/combinedMarketStream/messages/setPropertyResponse'

  combinedMarketStreamGetProperty:
    title: Get Property from Combined Market Streams
    summary: Get a property from the combined market stream connection
    action: send
    x-channel-method: GetProperty
    channel:
      $ref: '#/channels/combinedMarketStream'
    messages:
      - $ref: '#/channels/combinedMarketStream/messages/getProperty'
    reply:
      channel:
        $ref: '#/channels/combinedMarketStream'
      messages:
        - $ref: '#/channels/combinedMarketStream/messages/getPropertyResponse'

  combinedMarketStreamsReceiveError:
    title: Receive Error Messages from Combined Market Streams
    summary: Receive error messages from combined market stream connection
    action: receive
    channel:
      $ref: '#/channels/combinedMarketStream'
    messages:
      - $ref: '#/channels/combinedMarketStream/messages/error'

components:
  messages:
    # Control messages
    subscribeRequest:
      name: Subscribe Request
      title: Subscribe to Streams
      summary: Request to subscribe to one or more streams
      contentType: application/json
      payload:
        $ref: '#/components/schemas/subscribeRequest'
      correlationId:
        location: $message.payload#/id
        description: Message correlation ID

    unsubscribeRequest:
      name: Unsubscribe Request
      title: Unsubscribe from Streams
      summary: Request to unsubscribe from one or more streams
      contentType: application/json
      payload:
        $ref: '#/components/schemas/unsubscribeRequest'
      correlationId:
        location: $message.payload#/id
        description: Message correlation ID

    subscribeResponse:
      name: Subscription Response
      title: Subscribe Response
      summary: Response to subscription request
      contentType: application/json
      payload:
        $ref: '#/components/schemas/subscriptionResponse'
      correlationId:
        location: $message.payload#/id
        description: Message correlation ID

    unsubscribeResponse:
      name: Unsubscription Response
      title: Unsubscribe Response
      summary: Response to unsubscription request
      contentType: application/json
      payload:
        $ref: '#/components/schemas/subscriptionResponse'
      correlationId:
        location: $message.payload#/id
        description: Message correlation ID

    listSubscriptionsRequest:
      name: List Subscriptions Request
      title: List Active Subscriptions
      summary: Request list of active subscriptions
      contentType: application/json
      payload:
        $ref: '#/components/schemas/listSubscriptionsRequest'
      correlationId:
        location: $message.payload#/id
        description: Message correlation ID

    listSubscriptionsResponse:
      name: List Subscriptions Response
      title: Active Subscriptions List
      summary: List of currently active subscriptions
      contentType: application/json
      payload:
        $ref: '#/components/schemas/listSubscriptionsResponse'
      correlationId:
        location: $message.payload#/id
        description: Message correlation ID

    setPropertyRequest:
      name: Set Property Request
      title: Set Property Request
      summary: Send a SET_PROPERTY request
      contentType: application/json
      payload:
        $ref: '#/components/schemas/setPropertyRequest'
      correlationId:
        location: $message.payload#/id
        description: Message correlation ID

    setPropertyResponse:
      name: Set Property Response
      title: Set Property Response
      summary: Response to set property request
      contentType: application/json
      payload:
        $ref: '#/components/schemas/setPropertyResponse'
      correlationId:
        location: $message.payload#/id
        description: Message correlation ID

    getPropertyRequest:
      name: Get Property Request
      title: Get Property Request
      summary: Send a GET_PROPERTY request
      contentType: application/json
      payload:
        $ref: '#/components/schemas/getPropertyRequest'
      correlationId:
        location: $message.payload#/id
        description: Message correlation ID

    getPropertyResponse:
      name: Get Property Response
      title: Get Property Response
      summary: Response to get property request
      contentType: application/json
      payload:
        $ref: '#/components/schemas/getPropertyResponse'
      correlationId:
        location: $message.payload#/id
        description: Message correlation ID

    errorMessage:
      name: Error Message
      title: Error Response
      summary: Error response from server
      x-error: true
      x-handler-key: error
      contentType: application/json
      payload:
        $ref: '#/components/schemas/errorResponse'

    # Stream data messages (raw format)
    aggregateTradeEvent:
      name: Aggregate Trade Event
      title: Aggregate Trade Event
      summary: The Aggregate Trade Streams push trade information that is aggregated for a single taker order.
      x-event: true
      x-stream-pattern: ['{symbol}@aggTrade']
      x-stream-params:
        symbol:
          $ref: '#/components/schemas/symbol'
      x-stream-example: ['btcusdt@aggTrade']
      contentType: application/json
      payload:
        $ref: '#/components/schemas/aggregateTradeEvent'

    tradeEvent:
      name: Trade Event
      title: Trade Event
      summary: The Trade Streams push raw trade information; each trade has a unique buyer and seller.
      x-event: true
      x-stream-pattern: ['{symbol}@trade']
      x-stream-params:
        symbol:
          $ref: '#/components/schemas/symbol'
      x-stream-example: ['btcusdt@trade']
      contentType: application/json
      payload:
        $ref: '#/components/schemas/tradeEvent'

    klineEvent:
      name: Kline Event
      title: Kline Event
      summary: The Kline/Candlestick Stream push updates to the current klines/candlestick every second in UTC+0/UTC+8 timezone.
      x-event: true
      x-stream-pattern: ['{symbol}@kline_{interval}', '{symbol}@kline_{interval}@+08:00']
      x-stream-params:
        symbol:
          $ref: '#/components/schemas/symbol'
        interval:
          $ref: '#/components/schemas/interval'
      x-stream-example: ['btcusdt@kline_1m']
      x-update-speed: ['1000ms', '2000ms']
      contentType: application/json
      payload:
        $ref: '#/components/schemas/klineEvent'

    miniTickerEvent:
      name: Mini Ticker Event
      title: 24hr Mini Ticker Event
      summary: 24hr rolling window mini-ticker statistics. These are NOT the statistics of the UTC day, but a 24hr rolling window for the previous 24hrs.
      x-event: true
      x-stream-pattern: ['{symbol}@miniTicker']
      x-stream-params:
        symbol:
          $ref: '#/components/schemas/symbol'
      x-stream-example: ['btcusdt@miniTicker']
      x-update-speed: ['1000ms']
      contentType: application/json
      payload:
        $ref: '#/components/schemas/miniTickerEvent'

    allMiniTickersEvent:
      name: All Mini Tickers Event
      title: All Market Mini Tickers
      summary: 24hr rolling window mini-ticker statistics for all symbols that changed in an array. These are NOT the statistics of the UTC day, but a 24hr rolling window for the previous 24hrs. Note that only tickers that have changed will be present in the array.
      x-event: true
      x-response-format: array
      x-event-type: 24hrMiniTicker
      x-stream-pattern: ['!miniTicker@arr']
      x-stream-example: ['!miniTicker@arr']
      x-update-speed: ['1000ms']
      contentType: application/json
      payload:
        $ref: '#/components/schemas/allMiniTickersEvent'

    tickerEvent:
      name: Ticker Event
      title: 24hr Ticker Event
      summary: 24hr rolling window ticker statistics for a single symbol. These are NOT the statistics of the UTC day, but a 24hr rolling window for the previous 24hrs.
      x-event: true
      x-stream-pattern: ['{symbol}@ticker']
      x-stream-params:
        symbol:
          $ref: '#/components/schemas/symbol'
      x-stream-example: ['btcusdt@ticker']
      x-update-speed: ['1000ms']
      contentType: application/json
      payload:
        $ref: '#/components/schemas/tickerEvent'

    allTickersEvent:
      name: All Tickers Event
      title: All Market Tickers
      summary: 24hr rolling window ticker statistics for all symbols that changed in an array. These are NOT the statistics of the UTC day, but a 24hr rolling window for the previous 24hrs. Note that only tickers that have changed will be present in the array.
      x-event: true
      x-response-format: array
      x-event-type: 24hrTicker
      x-stream-pattern: ['!ticker@arr']
      x-stream-example: ['!ticker@arr']
      x-update-speed: ['1000ms']
      contentType: application/json
      payload:
        $ref: '#/components/schemas/allTickersEvent'

    rollingWindowTickerEvent:
      name: Rolling Window Ticker Event
      title: Rolling Window Statistics Event
      summary: Rolling window ticker statistics for a single symbol, computed over multiple windows.
      x-event: true
      x-stream-pattern: ['{symbol}@ticker_{windowSize}']
      x-stream-params:
        symbol:
          $ref: '#/components/schemas/symbol'
        windowSize:
          $ref: '#/components/schemas/windowSize'
      x-stream-example: ['btcusdt@ticker_1h']
      x-update-speed: ['1000ms']
      contentType: application/json
      payload:
        $ref: '#/components/schemas/rollingWindowTickerEvent'

    allRollingWindowTickersEvent:
      name: All Rolling Window Tickers Event
      title: All Market Rolling Window Statistics
      summary: Rolling window ticker statistics for all market symbols, computed over multiple windows. Note that only tickers that have changed will be present in the array.
      x-event: true
      x-response-format: array
      x-stream-pattern: ['!ticker_{windowSize}@arr']
      x-stream-params:
        windowSize:
          $ref: '#/components/schemas/windowSize'
      x-stream-example: ['!ticker_1h@arr']
      x-update-speed: ['1000ms']
      contentType: application/json
      payload:
        $ref: '#/components/schemas/allRollingWindowTickersEvent'

    bookTickerEvent:
      name: Book Ticker Event
      title: Book Ticker Event
      summary: Pushes any update to the best bid or ask's price or quantity in real-time for a specified symbol. Multiple <symbol>@bookTicker streams can be subscribed to over one connection.
      x-event: true
      x-stream-pattern: ['{symbol}@bookTicker']
      x-stream-params:
        symbol:
          $ref: '#/components/schemas/symbol'
      x-no-event-type: true
      x-stream-example: ['btcusdt@bookTicker']
      contentType: application/json
      payload:
        $ref: '#/components/schemas/bookTickerEvent'

    avgPriceEvent:
      name: Average Price Event
      title: Average Price Event
      summary: Average price streams push changes in the average price over a fixed time interval.
      x-event: true
      x-stream-pattern: ['{symbol}@avgPrice']
      x-stream-params:
        symbol:
          $ref: '#/components/schemas/symbol'
      x-stream-example: ['btcusdt@avgPrice']
      x-update-speed: ['1000ms']
      contentType: application/json
      payload:
        $ref: '#/components/schemas/avgPriceEvent'

    partialDepthEvent:
      name: Partial Depth Event
      title: Partial Book Depth Event
      summary: Partial book depth information
      x-event: true
      x-stream-pattern: ['{symbol}@depth{levels}', '{symbol}@depth{levels}@{speed}']
      x-stream-params:
        symbol:
          $ref: '#/components/schemas/symbol'
        levels:
          $ref: '#/components/schemas/depthLevels'
        speed:
          $ref: '#/components/schemas/depthSpeed'
      x-no-event-type: true
      x-stream-example: ['btcusdt@depth5@100ms']
      x-update-speed: ['100ms', '1000ms']
      contentType: application/json
      payload:
        $ref: '#/components/schemas/partialDepthEvent'

    diffDepthEvent:
      name: Diff Depth Event
      title: Depth Update Event
      summary: Order book depth update
      x-event: true
      x-stream-pattern: ['{symbol}@depth', '{symbol}@depth@{speed}']
      x-stream-params:
        symbol:
          $ref: '#/components/schemas/symbol'
        speed:
          $ref: '#/components/schemas/depthSpeed'
      x-stream-example: ['btcusdt@depth@100ms']
      x-update-speed: ['100ms', '1000ms']
      contentType: application/json
      payload:
        $ref: '#/components/schemas/diffDepthEvent'

    # Combined stream message (wrapped format)
    combinedMarketStreamEvent:
      name: Combined Stream Data Event
      title: Combined Stream Wrapper
      summary: Wrapper for combined stream data (combined connection)
      contentType: application/json
      x-event: true
      x-use-desc-naming: false
      x-wrapper: combined
      x-handler-key: wrap:combined
      x-wrapper-keys:
        stream: stream
        data: data
      payload:
        $ref: '#/components/schemas/combinedStreamEvent'

  schemas:
    # Reusable message id schema for requests/responses
    id:
      description: |
        The id is used as an identifier to uniquely identify the messages going back and forth.
        Accepted formats:
        - 64-bit signed integer
        - Alphanumeric strings; max length 36
        - null
      oneOf:
        - type: integer
          format: int64
        - type: string
          maxLength: 36
        - type: 'null'

    # Simple parameter schemas used in stream patterns
    symbol:
      type: string
      description: Trading pair symbol in lowercase (e.g., btcusdt)
    interval:
      type: string
      description: Kline/Candlestick interval
    windowSize:
      type: string
      description: Rolling window for statistics (e.g., 1h, 4h, 1d)
    depthSpeed:
      type: string
      description: Update speed for depth streams
      enum:
        - 100ms
        - 1000ms
    depthLevels:
      type: integer
      description: Number of levels for partial depth streams
      enum:
        - 5
        - 10
        - 20

    # Control schemas
    subscribeRequest:
      type: object
      description: |
        Request to subscribe to one or more streams. Stream names should follow
        Binance naming conventions (lowercase, with @ separators).
        
        Supported stream patterns:
        
        Individual Symbol Streams:
        - Trade: `{symbol}@aggTrade`, `{symbol}@trade`
        - Kline: `{symbol}@kline_{interval}`, `{symbol}@kline_{interval}@+08:00`
        - Ticker: `{symbol}@miniTicker`, `{symbol}@ticker`, `{symbol}@ticker_{windowSize}`
        - Book: `{symbol}@bookTicker`, `{symbol}@avgPrice`
        - Depth: `{symbol}@depth`, `{symbol}@depth{levels}`, with optional @{speed}
        
        All Market Streams (arrays):
        - `!ticker@arr`, `!miniTicker@arr`, `!ticker_{windowSize}@arr`
      required:
        - method
        - params
        - id
      properties:
        method:
          type: string
          const: SUBSCRIBE
          description: Method name
        params:
          type: array
          description: Array of stream names to subscribe to
          items:
            type: string
            pattern: '^[a-z0-9!@._:+\-]+$'
          examples:
            - ["btcusdt@aggTrade"]
            - ["btcusdt@aggTrade", "btcusdt@depth5@100ms"]
            - ["!ticker@arr"]
            - ["ethusdt@kline_1m", "btcusdt@trade"]
            - ["btcusdt@kline_1h@+08:00"]
            - ["btcusdt@avgPrice", "ethusdt@bookTicker"]
            - ["!miniTicker@arr"]
            - ["btcusdt@ticker_4h", "ethusdt@depth20@1000ms"]
        id:
          $ref: '#/components/schemas/id'

    unsubscribeRequest:
      type: object
      required:
        - method
        - params
        - id
      properties:
        method:
          type: string
          const: UNSUBSCRIBE
          description: Method name
        params:
          type: array
          description: Array of stream names to unsubscribe from
          items:
            type: string
          example: ["btcusdt@depth"]
        id:
          $ref: '#/components/schemas/id'

    subscriptionResponse:
      type: object
      properties:
        result:
          type: "null"
          description: Always null for successful subscription
        id:
          $ref: '#/components/schemas/id'

    listSubscriptionsRequest:
      type: object
      required:
        - method
        - id
      properties:
        method:
          type: string
          const: LIST_SUBSCRIPTIONS
          description: Method name
        id:
          $ref: '#/components/schemas/id'

    listSubscriptionsResponse:
      type: object
      properties:
        result:
          type: array
          description: Array of active stream names
          items:
            type: string
          example: ["btcusdt@aggTrade", "btcusdt@ticker"]
        id:
          $ref: '#/components/schemas/id'

    setPropertyRequest:
      type: object
      required:
        - method
        - params
        - id
      properties:
        method:
          type: string
          const: SET_PROPERTY
          description: Method name
        params:
          type: array
          description: Array containing property name and value
          items:
            oneOf:
              - type: string
              - type: boolean
          minItems: 2
          maxItems: 2
          example: ["combined", true]
        id:
          $ref: '#/components/schemas/id'

    setPropertyResponse:
      type: object
      properties:
        result:
          type: "null"
          description: Always null for successful property setting
        id:
          $ref: '#/components/schemas/id'

    getPropertyRequest:
      type: object
      required:
        - method
        - params
        - id
      properties:
        method:
          type: string
          const: GET_PROPERTY
          description: Method name
        params:
          type: array
          description: Array containing property name to retrieve
          items:
            type: string
          minItems: 1
          maxItems: 1
          example: ["combined"]
        id:
          $ref: '#/components/schemas/id'

    getPropertyResponse:
      type: object
      properties:
        result:
          oneOf:
            - type: boolean
            - type: string
          description: Property value (currently only 'combined' property supported)
        id:
          $ref: '#/components/schemas/id'
          

    errorResponse:
      type: object
      properties:
        error:
          type: object
          properties:
            code:
              type: integer
              description: Error code
            msg:
              type: string
              description: Error message
        id:
          $ref: '#/components/schemas/id'


    # Stream event schemas
    aggregateTradeEvent:
      type: object
      required:
        - e
        - E
        - s
        - a
        - p
        - q
        - f
        - l
        - T
        - m
        - M
      properties:
        e:
          type: string
          description: Event type
          const: aggTrade
        E:
          type: integer
          format: int64
          description: Event time
          example: 1672304050123
        s:
          type: string
          description: Symbol
          example: BTCUSDT
        a:
          type: integer
          format: int64
          description: Aggregate trade ID
          example: 12345
        p:
          type: string
          description: Price
          example: "16800.50000000"
        q:
          type: string
          description: Quantity
          example: "0.01234000"
        f:
          type: integer
          format: int64
          description: First trade ID
          example: 100
        l:
          type: integer
          format: int64
          description: Last trade ID
          example: 105
        T:
          type: integer
          format: int64
          description: Trade time
          example: 1672304050120
        m:
          type: boolean
          description: Is the buyer the market maker
          example: false
        M:
          type: boolean
          description: Ignore
          example: true

    tradeEvent:
      type: object
      required:
        - e
        - E
        - s
        - t
        - p
        - q
        - b
        - a
        - T
        - m
        - M
      properties:
        e:
          type: string
          description: Event type
          const: trade
        E:
          type: integer
          format: int64
          description: Event time
          example: 1672304050123
        s:
          type: string
          description: Symbol
          example: BTCUSDT
        t:
          type: integer
          format: int64
          description: Trade ID
          example: 12345
        p:
          type: string
          description: Price
          example: "16800.50000000"
        q:
          type: string
          description: Quantity
          example: "0.01234000"
        b:
          type: integer
          format: int64
          description: Buyer order ID
          example: 88
        a:
          type: integer
          format: int64
          description: Seller order ID
          example: 50
        T:
          type: integer
          format: int64
          description: Trade time
          example: 1672304050120
        m:
          type: boolean
          description: Is the buyer the market maker
          example: true
        M:
          type: boolean
          description: Ignore
          example: true

    klineEvent:
      type: object
      required:
        - e
        - E
        - s
        - k
      properties:
        e:
          type: string
          description: Event type
          const: kline
        E:
          type: integer
          format: int64
          description: Event time
          example: 1672304050123
        s:
          type: string
          description: Symbol
          example: BTCUSDT
        k:
          type: object
          description: Kline data
          required:
            - t
            - T
            - s
            - i
            - f
            - L
            - o
            - c
            - h
            - l
            - v
            - n
            - x
            - q
            - V
            - Q
            - B
          properties:
            t:
              type: integer
              format: int64
              description: Kline start time
              example: 1672304040000
            T:
              type: integer
              format: int64
              description: Kline close time
              example: 1672304099999
            s:
              type: string
              description: Symbol
              example: BTCUSDT
            i:
              type: string
              description: Interval
              example: 1m
            f:
              type: integer
              format: int64
              description: First trade ID
              example: 100
            L:
              type: integer
              format: int64
              description: Last trade ID
              example: 200
            o:
              type: string
              description: Open price
              example: "16800.00000000"
            c:
              type: string
              description: Close price
              example: "16805.00000000"
            h:
              type: string
              description: High price
              example: "16810.00000000"
            l:
              type: string
              description: Low price
              example: "16795.00000000"
            v:
              type: string
              description: Base asset volume
              example: "100.00000000"
            n:
              type: integer
              description: Number of trades
              example: 100
            x:
              type: boolean
              description: Is this kline closed
              example: false
            q:
              type: string
              description: Quote asset volume
              example: "1680500.00000000"
            V:
              type: string
              description: Taker buy base asset volume
              example: "60.00000000"
            Q:
              type: string
              description: Taker buy quote asset volume
              example: "1008300.00000000"
            B:
              type: string
              description: Ignore
              example: "0"

    miniTickerEvent:
      type: object
      required:
        - e
        - E
        - s
        - c
        - o
        - h
        - l
        - v
        - q
      properties:
        e:
          type: string
          description: Event type
          const: 24hrMiniTicker
        E:
          type: integer
          format: int64
          description: Event time
          example: 1672304050123
        s:
          type: string
          description: Symbol
          example: BTCUSDT
        c:
          type: string
          description: Close price
          example: "16805.00000000"
        o:
          type: string
          description: Open price
          example: "16800.00000000"
        h:
          type: string
          description: High price
          example: "16810.00000000"
        l:
          type: string
          description: Low price
          example: "16795.00000000"
        v:
          type: string
          description: Total traded base asset volume
          example: "10000.00000000"
        q:
          type: string
          description: Total traded quote asset volume
          example: "168050000.00000000"

    allMiniTickersEvent:
      type: array
      items:
        $ref: '#/components/schemas/miniTickerEvent'

    tickerEvent:
      type: object
      required:
        - e
        - E
        - s
        - p
        - P
        - w
        - x
        - c
        - Q
        - b
        - B
        - a
        - A
        - o
        - h
        - l
        - v
        - q
        - O
        - C
        - F
        - L
        - n
      properties:
        e:
          type: string
          description: Event type
          const: 24hrTicker
        E:
          type: integer
          format: int64
          description: Event time
          example: 1672304050123
        s:
          type: string
          description: Symbol
          example: BTCUSDT
        p:
          type: string
          description: Price change
          example: "5.00000000"
        P:
          type: string
          description: Price change percent
          example: "0.030"
        w:
          type: string
          description: Weighted average price
          example: "16802.50000000"
        x:
          type: string
          description: First trade(F)-1 price (previous close)
          example: "16800.00000000"
        c:
          type: string
          description: Last price
          example: "16805.00000000"
        Q:
          type: string
          description: Last quantity
          example: "0.01234000"
        b:
          type: string
          description: Best bid price
          example: "16804.90000000"
        B:
          type: string
          description: Best bid quantity
          example: "5.00000000"
        a:
          type: string
          description: Best ask price
          example: "16805.10000000"
        A:
          type: string
          description: Best ask quantity
          example: "10.00000000"
        o:
          type: string
          description: Open price
          example: "16800.00000000"
        h:
          type: string
          description: High price
          example: "16810.00000000"
        l:
          type: string
          description: Low price
          example: "16795.00000000"
        v:
          type: string
          description: Total traded base asset volume
          example: "10000.00000000"
        q:
          type: string
          description: Total traded quote asset volume
          example: "168050000.00000000"
        O:
          type: integer
          format: int64
          description: Statistics open time
          example: 1672217650123
        C:
          type: integer
          format: int64
          description: Statistics close time
          example: 1672304050123
        F:
          type: integer
          format: int64
          description: First trade ID
          example: 100
        L:
          type: integer
          format: int64
          description: Last trade ID
          example: 10000
        n:
          type: integer
          description: Total number of trades
          example: 9901

    allTickersEvent:
      type: array
      items:
        $ref: '#/components/schemas/tickerEvent'

    rollingWindowTickerEvent:
      type: object
      required:
        - e
        - E
        - s
        - p
        - P
        - o
        - h
        - l
        - c
        - w
        - v
        - q
        - O
        - C
        - F
        - L
        - n
      properties:
        e:
          type: string
          description: Event type
          example: 1hTicker
        E:
          type: integer
          format: int64
          description: Event time
          example: 1672304050123
        s:
          type: string
          description: Symbol
          example: BTCUSDT
        p:
          type: string
          description: Price change
          example: "5.00000000"
        P:
          type: string
          description: Price change percent
          example: "0.030"
        o:
          type: string
          description: Open price
          example: "16800.00000000"
        h:
          type: string
          description: High price
          example: "16810.00000000"
        l:
          type: string
          description: Low price
          example: "16795.00000000"
        c:
          type: string
          description: Last price
          example: "16805.00000000"
        w:
          type: string
          description: Weighted average price
          example: "16802.50000000"
        v:
          type: string
          description: Total traded base asset volume
          example: "1000.00000000"
        q:
          type: string
          description: Total traded quote asset volume
          example: "16805000.00000000"
        O:
          type: integer
          format: int64
          description: Statistics open time
          example: 1672300450123
        C:
          type: integer
          format: int64
          description: Statistics close time
          example: 1672304050123
        F:
          type: integer
          format: int64
          description: First trade ID
          example: 0
        L:
          type: integer
          format: int64
          description: Last trade ID
          example: 18150
        n:
          type: integer
          description: Total number of trades
          example: 18151

    allRollingWindowTickersEvent:
      type: array
      items:
        $ref: '#/components/schemas/rollingWindowTickerEvent'

    bookTickerEvent:
      type: object
      required:
        - u
        - s
        - b
        - B
        - a
        - A
      properties:
        u:
          type: integer
          format: int64
          description: Order book updateId
          example: 400900217
        s:
          type: string
          description: Symbol
          example: BTCUSDT
        b:
          type: string
          description: Best bid price
          example: "16804.90000000"
        B:
          type: string
          description: Best bid quantity
          example: "5.00000000"
        a:
          type: string
          description: Best ask price
          example: "16805.10000000"
        A:
          type: string
          description: Best ask quantity
          example: "10.00000000"

    avgPriceEvent:
      type: object
      required:
        - e
        - E
        - s
        - i
        - w
        - T
      properties:
        e:
          type: string
          description: Event type
          const: avgPrice
        E:
          type: integer
          format: int64
          description: Event time
          example: 1672304050123
        s:
          type: string
          description: Symbol
          example: BTCUSDT
        i:
          type: string
          description: Average price interval
          example: "5m"
        w:
          type: string
          description: Average price
          example: "16802.50000000"
        T:
          type: integer
          format: int64
          description: Last trade time
          example: 1672304050120

    partialDepthEvent:
      type: object
      required:
        - lastUpdateId
        - bids
        - asks
      properties:
        lastUpdateId:
          type: integer
          format: int64
          description: Last update ID
          example: 160
        bids:
          type: array
          description: Bids
          items:
            type: array
            items:
              type: string
            minItems: 2
            maxItems: 2
          example: [["16804.90000000", "5.00000000"], ["16804.80000000", "10.00000000"]]
        asks:
          type: array
          description: Asks
          items:
            type: array
            items:
              type: string
            minItems: 2
            maxItems: 2
          example: [["16805.10000000", "10.00000000"], ["16805.20000000", "15.00000000"]]

    diffDepthEvent:
      type: object
      required:
        - e
        - E
        - s
        - U
        - u
        - b
        - a
      properties:
        e:
          type: string
          description: Event type
          const: depthUpdate
        E:
          type: integer
          format: int64
          description: Event time
          example: 1672304050123
        s:
          type: string
          description: Symbol
          example: BTCUSDT
        U:
          type: integer
          format: int64
          description: First update ID in event
          example: 157
        u:
          type: integer
          format: int64
          description: Final update ID in event
          example: 160
        b:
          type: array
          description: Bids to be updated
          items:
            type: array
            items:
              type: string
            minItems: 2
            maxItems: 2
          example: [["16804.90000000", "0.00000000"]]
        a:
          type: array
          description: Asks to be updated
          items:
            type: array
            items:
              type: string
            minItems: 2
            maxItems: 2
          example: [["16805.10000000", "10.00000000"]]

    combinedStreamEvent:
      type: object
      description: |
        Wrapper for combined stream data. When connecting to combined streams,
        all events are wrapped with this structure to identify the source stream.
        
        The 'stream' field contains the original stream name, and 'data' contains
        the original event data that would be received from an individual stream.
      required:
        - stream
        - data
      properties:
        stream:
          type: string
          description: Original stream name that generated this event
          examples:
            - "btcusdt@aggTrade"
            - "btcusdt@depth5@100ms"
            - "ethusdt@ticker"
            - "!ticker@arr"
        data:
          description: |
            Original stream event data (unwrapped). This is exactly the same data
            that would be received when connecting to the individual stream directly.
            The event type can be determined by examining the 'stream' field.
            
            For all-market streams (!ticker@arr, !miniTicker@arr), the data will be
            an array of events instead of a single event object.
          oneOf:
            # Single event objects
            - $ref: '#/components/schemas/aggregateTradeEvent'
            - $ref: '#/components/schemas/tradeEvent'
            - $ref: '#/components/schemas/klineEvent'
            - $ref: '#/components/schemas/miniTickerEvent'
            - $ref: '#/components/schemas/allMiniTickersEvent'
            - $ref: '#/components/schemas/tickerEvent'
            - $ref: '#/components/schemas/allTickersEvent'
            - $ref: '#/components/schemas/rollingWindowTickerEvent'
            - $ref: '#/components/schemas/allRollingWindowTickersEvent'
            - $ref: '#/components/schemas/bookTickerEvent'
            - $ref: '#/components/schemas/avgPriceEvent'
            - $ref: '#/components/schemas/partialDepthEvent'
            - $ref: '#/components/schemas/diffDepthEvent'

      examples:
        - stream: "btcusdt@aggTrade"
          data:
            e: "aggTrade"
            E: 1672304050123
            s: "BTCUSDT"
            a: 12345
            p: "16800.50000000"
            q: "0.01234000"
            f: 100
            l: 105
            T: 1672304050120
            m: false
        - stream: "!ticker@arr"
          data:
            - e: "24hrTicker"
              E: 1672304050123
              s: "BTCUSDT"
              p: "1000.00000000"
              P: "2.12"
              w: "47500.00000000"
              c: "48000.00000000"
              Q: "0.5"
              o: "47000.00000000"
              h: "49000.00000000"
              l: "46000.00000000"
              v: "25000.00000000"
              q: "1187500000.00000000"
              O: 1672217650123
              C: 1672304050123
              F: 1000
              L: 2000
              n: 1001
            - e: "24hrTicker"
              E: 1672304050123
              s: "ETHUSDT"
              p: "50.00000000"
              P: "1.5"
              w: "3300.00000000"
              c: "3350.00000000"
              Q: "1.0"
              o: "3300.00000000"
              h: "3400.00000000"
              l: "3200.00000000"
              v: "100000.00000000"
              q: "330000000.00000000"
              O: 1672217650123
              C: 1672304050123
              F: 3000
              L: 4000
              n: 1001
